;-----------------------------------------------------------------------------
; http://datadump.ru/fasm-byte-word-dword-to-string/#comment-5698
; Функция преобразования двойного слова в ASCII представление		
; 
;-----------------------------------------------------------------------------
; INPUT
; EAX = Данные для конвертации
; EDI = выходной буфер - строка, представляющая hex данные


hex_dword_2_str:

	mov	ecx, 8		; в двойном слове 8 нибблов (полубайт)
@@:
	rol	eax, 4		; выдвигаем младшие 4 бита
	push	eax		; сохраним EAX
	and	al, 0Fh		; оставляем 4 младших бита AL
	cmp	al, 0Ah		; сравниваем AL со значение 10
	sbb	al, 69h		; целочисленное вычитание с заёмом
	das			    ; BCD-коррекция после вычитания
	stosb           ; помещаем получившийся символ в буфер
	pop	eax		    ; восстановим EAX
	loop	@b		; цикл
	ret		